<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Lucro Certo</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="./public/images/favicon.svg">
    <link rel="apple-touch-icon" href="./public/images/favicon.svg">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Meta Pixel & Analytics - TRACKING COMPLETO -->
    <script src="./public/js/tracking.js"></script>
    <style>
        :root {
            --primary: #E91E63;
            --primary-dark: #C2185B;
            --primary-light: #F8BBD9;
            --primary-gradient: linear-gradient(135deg, #E91E63 0%, #FF6B9D 100%);
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --info: #2196F3;
            --text-primary: #1A1A2E;
            --text-secondary: #4A4A68;
            --elegant-gray: #6B7280;
            --light-gray: #F5F5F7;
            --background: #FAFBFC;
            --white: #FFFFFF;
            --border: rgba(0, 0, 0, 0.08);
            --shadow-soft: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-medium: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            background: var(--background);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .admin-layout { display: flex; min-height: 100vh; }

        /* Sidebar */
        .sidebar {
            width: 260px;
            background: var(--white);
            border-right: 1px solid var(--border);
            padding: 24px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 32px;
        }

        .logo-icon {
            width: 44px;
            height: 44px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo-icon svg { width: 24px; height: 24px; color: white; }

        .logo-text { font-size: 18px; font-weight: 700; color: var(--text-primary); }

        .logo-badge {
            font-size: 10px;
            background: var(--primary);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            margin-left: auto;
        }

        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin-bottom: 4px; }

        .sidebar-nav a, .sidebar-nav button {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: var(--elegant-gray);
            text-decoration: none;
            border-radius: 10px;
            transition: var(--transition-smooth);
            font-size: 14px;
            font-weight: 500;
            background: none;
            border: none;
            width: 100%;
            cursor: pointer;
            font-family: inherit;
        }

        .sidebar-nav a:hover, .sidebar-nav button:hover {
            background: var(--light-gray);
            color: var(--text-primary);
        }

        .sidebar-nav a.active, .sidebar-nav button.active {
            background: rgba(233, 30, 99, 0.1);
            color: var(--primary);
        }

        .sidebar-nav svg { width: 20px; height: 20px; }

        .nav-section-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--elegant-gray);
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 20px 16px 10px;
        }

        /* Main Content */
        .main-content { flex: 1; margin-left: 260px; padding: 32px; }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
        }

        .page-title { font-size: 28px; font-weight: 700; color: var(--text-primary); }
        .page-subtitle { font-size: 14px; color: var(--elegant-gray); margin-top: 4px; }
        .header-actions { display: flex; gap: 12px; }

        .btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            border: none;
            text-decoration: none;
        }

        .btn-primary { background: var(--primary-gradient); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-medium); }
        .btn-secondary { background: var(--light-gray); color: var(--text-primary); }
        .btn-secondary:hover { background: #EBEBED; }
        .btn-success { background: var(--success); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn svg { width: 18px; height: 18px; }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--white);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
            transition: var(--transition-smooth);
        }

        .stat-card:hover { box-shadow: var(--shadow-medium); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .stat-icon svg { width: 24px; height: 24px; }
        .stat-icon.primary { background: rgba(233, 30, 99, 0.1); color: var(--primary); }
        .stat-icon.success { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        .stat-icon.warning { background: rgba(255, 152, 0, 0.1); color: var(--warning); }
        .stat-icon.info { background: rgba(33, 150, 243, 0.1); color: var(--info); }

        .stat-value { font-size: 32px; font-weight: 700; color: var(--text-primary); margin-bottom: 4px; }
        .stat-label { font-size: 14px; color: var(--elegant-gray); }

        /* Card */
        .card {
            background: var(--white);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .card-title { font-size: 18px; font-weight: 600; color: var(--text-primary); }
        .card-body { padding: 24px; }

        .content-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; }

        /* Table */
        .data-table { width: 100%; border-collapse: collapse; }

        .data-table th, .data-table td {
            text-align: left;
            padding: 14px 16px;
            border-bottom: 1px solid var(--border);
        }

        .data-table th {
            font-size: 12px;
            font-weight: 600;
            color: var(--elegant-gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--light-gray);
        }

        .data-table td { font-size: 14px; color: var(--text-primary); }
        .data-table tr:last-child td { border-bottom: none; }
        .data-table tr:hover td { background: var(--light-gray); }

        /* Badge */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
        }

        .badge.new { background: rgba(233, 30, 99, 0.1); color: var(--primary); }
        .badge.contacted { background: rgba(33, 150, 243, 0.1); color: var(--info); }
        .badge.converted { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        .badge.pending { background: rgba(255, 152, 0, 0.1); color: var(--warning); }
        .badge.active { background: rgba(76, 175, 80, 0.1); color: var(--success); }
        .badge.cancelled { background: rgba(244, 67, 54, 0.1); color: var(--danger); }

        /* Action Buttons */
        .action-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--light-gray);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--elegant-gray);
            transition: var(--transition-smooth);
        }

        .action-btn:hover { background: var(--primary); color: white; }
        .action-btn svg { width: 16px; height: 16px; }
        .actions-cell { display: flex; gap: 8px; }

        /* Search & Filters */
        .toolbar { display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; }

        .search-bar {
            display: flex;
            align-items: center;
            background: var(--light-gray);
            border-radius: 10px;
            padding: 10px 16px;
            gap: 8px;
            flex: 1;
            min-width: 200px;
        }

        .search-bar input {
            flex: 1;
            border: none;
            background: none;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            outline: none;
            color: var(--text-primary);
        }

        .search-bar svg { width: 20px; height: 20px; color: var(--elegant-gray); }

        .filter-btn {
            padding: 10px 16px;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 13px;
            color: var(--elegant-gray);
            cursor: pointer;
            transition: var(--transition-smooth);
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }

        /* Niches List */
        .niches-list { list-style: none; }

        .niche-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .niche-item:last-child { border-bottom: none; }

        .niche-icon {
            width: 40px;
            height: 40px;
            background: var(--light-gray);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .niche-info { flex: 1; }
        .niche-name { font-size: 14px; font-weight: 600; color: var(--text-primary); margin-bottom: 4px; }

        .niche-bar {
            height: 6px;
            background: var(--light-gray);
            border-radius: 3px;
            overflow: hidden;
        }

        .niche-bar-fill {
            height: 100%;
            background: var(--primary-gradient);
            border-radius: 3px;
        }

        .niche-count { font-size: 14px; font-weight: 600; color: var(--text-primary); min-width: 40px; text-align: right; }

        /* Empty State */
        .empty-state { text-align: center; padding: 60px 20px; }

        .empty-icon {
            width: 80px;
            height: 80px;
            background: var(--light-gray);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }

        .empty-icon svg { width: 40px; height: 40px; color: var(--elegant-gray); }
        .empty-title { font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
        .empty-text { font-size: 14px; color: var(--elegant-gray); }

        /* Page Sections */
        .page-section { display: none; }
        .page-section.active { display: block; }

        /* Form Styles */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 14px; font-weight: 500; color: var(--text-primary); margin-bottom: 8px; }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: var(--transition-smooth);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(233, 30, 99, 0.1);
        }

        .form-row { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-smooth);
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal {
            background: var(--white);
            border-radius: 16px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title { font-size: 18px; font-weight: 600; }
        .modal-close { background: none; border: none; cursor: pointer; color: var(--elegant-gray); }
        .modal-body { padding: 24px; }

        .modal-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        .info-text {
            background: rgba(33, 150, 243, 0.1);
            border-radius: 10px;
            padding: 16px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 20px;
        }

        .info-text svg { color: var(--info); flex-shrink: 0; }
        .info-text p { font-size: 14px; color: var(--text-secondary); }

        /* Responsive */
        @media (max-width: 1200px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .content-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 20px; }
            .stats-grid { grid-template-columns: 1fr; }
            .page-header { flex-direction: column; align-items: flex-start; gap: 16px; }
            .form-row { grid-template-columns: 1fr; }
        }

        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 101;
            background: var(--primary);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 10px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; align-items: center; justify-content: center; }
        }

        .table-wrapper { overflow-x: auto; }
    </style>
</head>
<body>
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i data-lucide="menu"></i>
    </button>

    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <div class="logo-icon">
                    <i data-lucide="sparkles"></i>
                </div>
                <span class="logo-text">Lucro Certo</span>
                <span class="logo-badge">Admin</span>
            </div>

            <ul class="sidebar-nav">
                <li>
                    <button class="nav-btn active" data-page="dashboard">
                        <i data-lucide="layout-dashboard"></i>
                        Dashboard
                    </button>
                </li>
                <li>
                    <button class="nav-btn" data-page="leads">
                        <i data-lucide="users"></i>
                        Leads
                    </button>
                </li>
                <li>
                    <button class="nav-btn" data-page="todos-usuarios">
                        <i data-lucide="database"></i>
                        Todos Usu√°rios
                        <span class="badge-count" id="todosUsuariosCount" style="margin-left: auto; background: #2196F3; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">0</span>
                    </button>
                </li>
                <li>
                    <button class="nav-btn" data-page="trials">
                        <i data-lucide="clock"></i>
                        Teste Gr√°tis
                        <span class="badge-count" id="trialsCount" style="margin-left: auto; background: #FF9800; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 600;">0</span>
                    </button>
                </li>
                <li>
                    <button class="nav-btn" data-page="assinantes">
                        <i data-lucide="user-check"></i>
                        Assinantes
                    </button>
                </li>
                
                <li class="nav-section-title">Marketing</li>
                
                <li>
                    <button class="nav-btn" data-page="cupons">
                        <i data-lucide="ticket"></i>
                        Cupons
                    </button>
                </li>
                <li>
                    <button class="nav-btn" data-page="campanhas">
                        <i data-lucide="megaphone"></i>
                        Campanhas
                    </button>
                </li>

                <li class="nav-section-title">Relat√≥rios</li>
                
                <li>
                    <button class="nav-btn" data-page="nichos">
                        <i data-lucide="pie-chart"></i>
                        Por Nicho
                    </button>
                </li>

                <li class="nav-section-title">Sistema</li>

                <li>
                    <button class="nav-btn" data-page="config">
                        <i data-lucide="settings"></i>
                        Configura√ß√µes
                    </button>
                </li>
                <li>
                    <a href="index">
                        <i data-lucide="arrow-left"></i>
                        Voltar ao App
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- ========== DASHBOARD ========== -->
            <section class="page-section active" id="page-dashboard">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-subtitle">Vis√£o geral dos seus leads e convers√µes</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportLeadsCSV()">
                            <i data-lucide="download"></i>
                            Exportar
                        </button>
                        <button class="btn btn-primary" onclick="loadData()">
                            <i data-lucide="refresh-cw"></i>
                            Atualizar
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon primary">
                                <i data-lucide="users"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalLeads">0</div>
                        <div class="stat-label">Total de Leads</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon success">
                                <i data-lucide="user-check"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalAssinantes">0</div>
                        <div class="stat-label">Assinantes</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon warning">
                                <i data-lucide="users"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="totalTrials">0</div>
                        <div class="stat-label">Em Trial</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon info">
                                <i data-lucide="dollar-sign"></i>
                            </div>
                        </div>
                        <div class="stat-value" id="receitaTotal">R$ 0</div>
                        <div class="stat-label">Receita Total</div>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">√öltimos Leads</h2>
                        </div>
                        <div class="card-body">
                            <div class="table-wrapper">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Contato</th>
                                            <th>Data</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="dashboardLeadsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Por Nicho</h2>
                        </div>
                        <div class="card-body">
                            <ul class="niches-list" id="dashboardNiches">
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== LEADS ========== -->
            <section class="page-section" id="page-leads">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Leads</h1>
                        <p class="page-subtitle">Gerencie todos os leads capturados</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportLeadsCSV()">
                            <i data-lucide="download"></i>
                            Exportar CSV
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="toolbar">
                            <div class="search-bar">
                                <i data-lucide="search"></i>
                                <input type="text" placeholder="Buscar por nome ou email..." id="searchLeads">
                            </div>
                            <button class="filter-btn active" data-filter="all">Todos</button>
                            <button class="filter-btn" data-filter="new">Trials</button>
                            <button class="filter-btn" data-filter="converted">Assinantes</button>
                        </div>

                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Usu√°rio</th>
                                        <th>Telefone</th>
                                        <th>Status</th>
                                        <th>Plano</th>
                                        <th>Cadastro</th>
                                        <th>Assinatura</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="leadsTableBody">
                                </tbody>
                            </table>
                        </div>

                        <div class="empty-state" id="emptyLeads" style="display: none;">
                            <div class="empty-icon">
                                <i data-lucide="inbox"></i>
                            </div>
                            <h3 class="empty-title">Nenhum lead ainda</h3>
                            <p class="empty-text">Os leads capturados no popup aparecer√£o aqui.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== TODOS OS USU√ÅRIOS CADASTRADOS ========== -->
            <section class="page-section" id="page-todos-usuarios">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üë• Todos os Usu√°rios Cadastrados</h1>
                        <p class="page-subtitle">Lista completa de TODOS que se cadastraram no sistema (banco de dados)</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="loadTodosUsuarios()">
                            <i data-lucide="refresh-cw"></i>
                            Atualizar
                        </button>
                        <button class="btn btn-secondary" onclick="exportTodosUsuarios()">
                            <i data-lucide="download"></i>
                            Exportar CSV
                        </button>
                    </div>
                </div>

                <div class="stats-grid" style="margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #2196F3;">
                            <i data-lucide="database"></i>
                        </div>
                        <div>
                            <div class="stat-label">Total Cadastrados</div>
                            <div class="stat-value" id="totalCadastrados">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #FF9800;">
                            <i data-lucide="clock"></i>
                        </div>
                        <div>
                            <div class="stat-label">Em Trial</div>
                            <div class="stat-value" id="totalTrialsCount">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #4CAF50;">
                            <i data-lucide="credit-card"></i>
                        </div>
                        <div>
                            <div class="stat-label">Pagos</div>
                            <div class="stat-value" id="totalPagosCount">0</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #9C27B0;">
                            <i data-lucide="user-plus"></i>
                        </div>
                        <div>
                            <div class="stat-label">√öltimos 7 dias</div>
                            <div class="stat-value" id="novosUsuarios">0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Email</th>
                                        <th>Telefone</th>
                                        <th>Plano</th>
                                        <th>Status Assinatura</th>
                                        <th>Cadastro</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="todosUsuariosTableBody">
                                    <!-- Dados carregados via JS -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="empty-state" id="emptyTodosUsuarios" style="display: none;">
                            <div class="empty-icon">
                                <i data-lucide="database"></i>
                            </div>
                            <h3 class="empty-title">Nenhum usu√°rio cadastrado</h3>
                            <p class="empty-text">Quando algu√©m se cadastrar, aparecer√° aqui.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== USU√ÅRIOS TRIAL ========== -->
            <section class="page-section" id="page-trials">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">üß™ Usu√°rios em Teste Gr√°tis</h1>
                        <p class="page-subtitle">Acompanhe quem est√° testando o sistema (7 dias gr√°tis)</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-secondary" onclick="exportTrials()">
                            <i data-lucide="download"></i>
                            Exportar
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Usu√°rio</th>
                                        <th>Email</th>
                                        <th>Iniciou em</th>
                                        <th>Expira em</th>
                                        <th>Dias Restantes</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="trialsTableBody">
                                    <!-- Dados carregados via JS -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="empty-state" id="emptyTrials" style="display: none;">
                            <div class="empty-icon">
                                <i data-lucide="clock"></i>
                            </div>
                            <h3 class="empty-title">Nenhum usu√°rio em teste</h3>
                            <p class="empty-text">Quando algu√©m iniciar o teste gr√°tis, aparecer√° aqui.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== ASSINANTES ========== -->
            <section class="page-section" id="page-assinantes">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Assinantes</h1>
                        <p class="page-subtitle">Gerencie seus assinantes ativos</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="empty-state" id="emptyAssinantes">
                            <div class="empty-icon">
                                <i data-lucide="users"></i>
                            </div>
                            <h3 class="empty-title">Nenhum assinante ainda</h3>
                            <p class="empty-text">Quando tiver assinantes via Mercado Pago, eles aparecer√£o aqui.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== CUPONS ========== -->
            <section class="page-section" id="page-cupons">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Cupons</h1>
                        <p class="page-subtitle">Gerencie seus cupons de desconto</p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" onclick="openCouponModal()">
                            <i data-lucide="plus"></i>
                            Novo Cupom
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body">
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>C√≥digo</th>
                                        <th>Desconto</th>
                                        <th>Usos</th>
                                        <th>Validade</th>
                                        <th>Status</th>
                                        <th>A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="cuponsTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== CAMPANHAS ========== -->
            <section class="page-section" id="page-campanhas">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Campanhas</h1>
                        <p class="page-subtitle">Envie mensagens para seus leads</p>
                    </div>
                </div>

                <div class="info-text">
                    <i data-lucide="info"></i>
                    <p>Use esta se√ß√£o para criar mensagens de WhatsApp ou Email para enviar aos seus leads. Voc√™ pode segmentar por status.</p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Nova Campanha</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label class="form-label">Tipo de Campanha</label>
                            <select class="form-input" id="campanhaTipo">
                                <option value="whatsapp">WhatsApp</option>
                                <option value="email">Email</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Segmento</label>
                            <select class="form-input" id="campanhaSegmento">
                                <option value="all">Todos os Leads</option>
                                <option value="new">Apenas Novos</option>
                                <option value="contacted">J√° Contatados</option>
                                <option value="cupom">Com Cupom n√£o usado</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Mensagem</label>
                            <textarea class="form-input" rows="5" id="campanhaMensagem" placeholder="Ol√° {nome}! Vimos que voc√™ se interessou pelo Lucro Certo..."></textarea>
                        </div>

                        <button class="btn btn-primary" onclick="gerarListaCampanha()">
                            <i data-lucide="send"></i>
                            Gerar Lista de Envio
                        </button>
                    </div>
                </div>

                <div class="card" id="listaEnvioCard" style="display: none;">
                    <div class="card-header">
                        <h2 class="card-title">Lista de Envio</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-wrapper">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Contato</th>
                                        <th>A√ß√£o</th>
                                    </tr>
                                </thead>
                                <tbody id="listaEnvioBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ========== NICHOS ========== -->
            <section class="page-section" id="page-nichos">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">An√°lise por Nicho</h1>
                        <p class="page-subtitle">Veja quais nichos t√™m mais interesse</p>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: #FCE4EC; font-size: 24px;">üëó</div>
                        </div>
                        <div class="stat-value" id="nichoModa">0</div>
                        <div class="stat-label">Moda & Acess√≥rios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: #F3E5F5; font-size: 24px;">üíÑ</div>
                        </div>
                        <div class="stat-value" id="nichoCosmeticos">0</div>
                        <div class="stat-label">Cosm√©ticos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: #E8F5E9; font-size: 24px;">üè†</div>
                        </div>
                        <div class="stat-value" id="nichoCasa">0</div>
                        <div class="stat-label">Casa & Decora√ß√£o</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-icon" style="background: #FFF3E0; font-size: 24px;">üç∞</div>
                        </div>
                        <div class="stat-value" id="nichoAlimentacao">0</div>
                        <div class="stat-label">Alimenta√ß√£o</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Distribui√ß√£o de Leads por Nicho</h2>
                    </div>
                    <div class="card-body">
                        <ul class="niches-list" id="nichosDetalhados">
                        </ul>
                    </div>
                </div>
            </section>

            <!-- ========== CONFIGURA√á√ïES ========== -->
            <section class="page-section" id="page-config">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Configura√ß√µes</h1>
                        <p class="page-subtitle">Configure o painel administrativo</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Dados do Admin</h2>
                    </div>
                    <div class="card-body">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Nome</label>
                                <input type="text" class="form-input" value="Carol" id="adminNome">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" value="admin@lucrocerto.com" id="adminEmail">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="salvarConfig()">
                            <i data-lucide="save"></i>
                            Salvar
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Limpar Dados</h2>
                    </div>
                    <div class="card-body">
                        <p style="margin-bottom: 16px; color: var(--elegant-gray);">Cuidado! Esta a√ß√£o n√£o pode ser desfeita.</p>
                        <button class="btn btn-danger" onclick="limparLeads()">
                            <i data-lucide="trash-2"></i>
                            Limpar Todos os Leads
                        </button>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Modal Novo Cupom -->
    <div class="modal-overlay" id="couponModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Novo Cupom</h3>
                <button class="modal-close" onclick="closeCouponModal()">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">C√≥digo do Cupom</label>
                    <input type="text" class="form-input" id="cupomCodigo" placeholder="Ex: PROMO20" style="text-transform: uppercase;">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Desconto (%)</label>
                        <input type="number" class="form-input" id="cupomDesconto" placeholder="10" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Limite de Usos</label>
                        <input type="number" class="form-input" id="cupomLimite" placeholder="100">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Validade</label>
                    <input type="date" class="form-input" id="cupomValidade">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCouponModal()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarCupom()">Criar Cupom</button>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();

        // ========== CONFIGURA√á√ÉO DA API ==========
        const API_BASE = '/.netlify/functions/admin-api';
        const ADMIN_PASSWORD = 'lucrocerto2024'; // Senha para acesso admin
        
        // Verificar se est√° autenticado como admin
        let isAdminAuthenticated = sessionStorage.getItem('admin_authenticated') === 'true';
        
        // ========== AUTENTICA√á√ÉO ADMIN ==========
        function checkAdminAuth() {
            if (!isAdminAuthenticated) {
                const password = prompt('üîê Digite a senha de administrador:');
                if (password === ADMIN_PASSWORD) {
                    isAdminAuthenticated = true;
                    sessionStorage.setItem('admin_authenticated', 'true');
                    loadDashboardFromAPI();
                } else {
                    alert('‚ùå Senha incorreta! Usando dados locais (localStorage).');
                    isAdminAuthenticated = false;
                    loadData(); // Fallback para localStorage
                }
            } else {
                loadDashboardFromAPI();
            }
        }
        
        // ========== BUSCAR DADOS DO SUPABASE ==========
        async function loadDashboardFromAPI() {
            try {
                showLoading(true);
                
                // Buscar estat√≠sticas do dashboard
                const response = await fetch(`${API_BASE}?action=dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${ADMIN_PASSWORD}`
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Erro ao buscar dados da API');
                }
                
                const data = await response.json();
                
                // Atualizar estat√≠sticas
                document.getElementById('totalLeads').textContent = data.totalUsuarios || 0;
                document.getElementById('totalAssinantes').textContent = data.totalAssinantes || 0;
                document.getElementById('totalTrials').textContent = data.totalTrials || 0;
                document.getElementById('receitaTotal').textContent = `R$ ${(data.receitaTotal || 0).toFixed(2)}`;
                
                // Atualizar contador no menu de trials
                const trialsCount = document.getElementById('trialsCount');
                if (trialsCount) {
                    trialsCount.textContent = data.totalTrials || 0;
                }
                
                // Atualizar tabela de usu√°rios recentes
                updateRecentUsersTable(data.usuariosRecentes || []);
                
                // Buscar lista completa de usu√°rios
                await loadAllUsers();
                
                // Carregar tamb√©m a lista de TODOS os usu√°rios cadastrados
                await loadTodosUsuarios();
                
                showLoading(false);
                console.log('‚úÖ Dados carregados do Supabase com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados da API:', error);
                showLoading(false);
                alert('‚ö†Ô∏è Erro ao conectar com o banco de dados. Usando dados locais.');
                loadData(); // Fallback para localStorage
            }
        }
        
        async function loadAllUsers() {
            try {
                const response = await fetch(`${API_BASE}?action=usuarios`, {
                    headers: {
                        'Authorization': `Bearer ${ADMIN_PASSWORD}`
                    }
                });
                
                if (!response.ok) throw new Error('Erro ao buscar usu√°rios');
                
                const data = await response.json();
                updateUsersTable(data.usuarios || []);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar usu√°rios:', error);
            }
        }
        
        function updateRecentUsersTable(usuarios) {
            const table = document.getElementById('dashboardLeadsTable');
            
            if (!usuarios || usuarios.length === 0) {
                table.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--elegant-gray);">Nenhum usu√°rio ainda</td></tr>';
                return;
            }
            
            table.innerHTML = usuarios.slice(0, 5).map(user => `
                <tr>
                    <td><strong>${user.nome || 'Sem nome'}</strong></td>
                    <td>${user.email}</td>
                    <td>${formatDate(user.created_at)}</td>
                    <td><span class="badge ${user.plano === 'trial' ? 'new' : 'converted'}">${getPlanName(user.plano)}</span></td>
                </tr>
            `).join('');
        }
        
        function updateUsersTable(usuarios) {
            const table = document.getElementById('leadsTableBody');
            const emptyState = document.getElementById('emptyLeads');
            
            if (!usuarios || usuarios.length === 0) {
                table.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            table.innerHTML = usuarios.map(user => {
                const assinatura = user.assinaturas?.[0];
                const isPaid = user.plano !== 'trial';
                const status = isPaid ? 'converted' : 'new';
                const statusText = isPaid ? 'Assinante' : 'Trial';
                
                return `
                    <tr data-status="${status}">
                        <td>
                            <div><strong>${user.nome || 'Sem nome'}</strong></div>
                            <div style="font-size: 12px; color: var(--elegant-gray);">${user.email}</div>
                        </td>
                        <td>${user.telefone || '-'}</td>
                        <td><span class="badge ${status}">${statusText}</span></td>
                        <td><span class="badge ${user.plano === 'trial' ? 'new' : 'converted'}">${getPlanName(user.plano)}</span></td>
                        <td>${formatDate(user.created_at)}</td>
                        <td>
                            ${assinatura ? `
                                <div style="font-size: 12px;">
                                    <div>R$ ${assinatura.valor?.toFixed(2) || '0.00'}</div>
                                    <div style="color: var(--elegant-gray);">${assinatura.periodo === 'monthly' ? 'Mensal' : 'Anual'}</div>
                                </div>
                            ` : '-'}
                        </td>
                        <td>
                            <button class="btn-icon" onclick="viewUserDetails('${user.id}')" title="Ver detalhes">
                                <i data-lucide="eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            lucide.createIcons();
        }
        
        // ========== CARREGAR USU√ÅRIOS TRIAL ==========
        async function loadTrials() {
            try {
                const response = await fetch(`${API_BASE}?action=usuarios`, {
                    headers: {
                        'Authorization': `Bearer ${ADMIN_PASSWORD}`
                    }
                });
                
                if (!response.ok) throw new Error('Erro ao buscar usu√°rios');
                
                const data = await response.json();
                const trials = data.usuarios?.filter(u => u.plano === 'trial') || [];
                
                updateTrialsTable(trials);
                
                // Atualizar contador no menu
                const trialsCount = document.getElementById('trialsCount');
                if (trialsCount) {
                    trialsCount.textContent = trials.length;
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar trials:', error);
            }
        }
        
        function updateTrialsTable(trials) {
            const table = document.getElementById('trialsTableBody');
            const emptyState = document.getElementById('emptyTrials');
            
            if (!trials || trials.length === 0) {
                table.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            table.innerHTML = trials.map(user => {
                // Calcular dias restantes
                const assinatura = user.assinaturas?.[0];
                let dataExpiracao = assinatura?.data_expiracao ? new Date(assinatura.data_expiracao) : null;
                const hoje = new Date();
                
                // Se n√£o tem data_expiracao, calcular baseado em created_at + 7 dias
                if (!dataExpiracao && user.created_at) {
                    const dataInicio = new Date(user.created_at);
                    dataExpiracao = new Date(dataInicio);
                    dataExpiracao.setDate(dataExpiracao.getDate() + 7);
                }
                
                let diasRestantes = 0;
                let statusClass = 'danger';
                let statusText = 'Expirado';
                
                if (dataExpiracao) {
                    const diff = dataExpiracao - hoje;
                    diasRestantes = Math.max(0, Math.ceil(diff / (1000 * 60 * 60 * 24)));
                    
                    if (diasRestantes === 0) {
                        statusClass = 'danger';
                        statusText = 'Expirado';
                    } else if (diasRestantes <= 2) {
                        statusClass = 'warning';
                        statusText = 'Expirando';
                    } else {
                        statusClass = 'success';
                        statusText = 'Ativo';
                    }
                }
                
                const dataInicio = user.created_at ? new Date(user.created_at) : null;
                const dataExpiraTexto = dataExpiracao ? dataExpiracao.toLocaleDateString('pt-BR') : '-';
                
                return `
                    <tr>
                        <td>
                            <div><strong>${user.nome || 'Sem nome'}</strong></div>
                        </td>
                        <td>
                            <div style="font-size: 13px;">${user.email}</div>
                        </td>
                        <td>${formatDate(user.created_at)}</td>
                        <td>${dataExpiraTexto}</td>
                        <td>
                            <span class="badge ${statusClass}" style="font-weight: 600;">
                                ${diasRestantes} ${diasRestantes === 1 ? 'dia' : 'dias'}
                            </span>
                        </td>
                        <td><span class="badge ${statusClass}">${statusText}</span></td>
                        <td>
                            <button class="btn-icon" onclick="viewTrialDetails('${user.id}')" title="Ver detalhes">
                                <i data-lucide="eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            lucide.createIcons();
        }
        
        function viewTrialDetails(userId) {
            alert(`Ver detalhes do usu√°rio trial: ${userId}\n\nEm breve: modal completo com hist√≥rico de uso!`);
        }
        
        function exportTrials() {
            alert('üîÑ Exportar lista de trials em desenvolvimento...');
        }
        
        // ========== CARREGAR TODOS OS USU√ÅRIOS ==========
        async function loadTodosUsuarios() {
            try {
                console.log('üîç Buscando TODOS os usu√°rios...');
                
                const response = await fetch(`${API_BASE}?action=todos-usuarios`, {
                    headers: {
                        'Authorization': `Bearer ${ADMIN_PASSWORD}`
                    }
                });
                
                console.log('üì° Response status:', response.status);
                
                if (!response.ok) throw new Error('Erro ao buscar todos os usu√°rios');
                
                const data = await response.json();
                console.log('üì¶ Dados recebidos:', data);
                
                const usuarios = data.usuarios || [];
                console.log(`üë• Total de usu√°rios encontrados: ${usuarios.length}`);
                console.log('üìã Lista de emails:', usuarios.map(u => u.email));
                
                updateTodosUsuariosTable(usuarios);
                updateTodosUsuariosStats(usuarios);
                
                // Atualizar contador no menu
                const countBadge = document.getElementById('todosUsuariosCount');
                if (countBadge) {
                    countBadge.textContent = usuarios.length;
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar todos usu√°rios:', error);
            }
        }
        
        function updateTodosUsuariosStats(usuarios) {
            const totalCadastrados = document.getElementById('totalCadastrados');
            const totalTrialsCount = document.getElementById('totalTrialsCount');
            const totalPagosCount = document.getElementById('totalPagosCount');
            const novosUsuarios = document.getElementById('novosUsuarios');
            
            if (totalCadastrados) totalCadastrados.textContent = usuarios.length;
            
            // Contar trials
            const trials = usuarios.filter(u => u.plano === 'trial');
            if (totalTrialsCount) totalTrialsCount.textContent = trials.length;
            
            // Contar pagos (planos diferentes de trial)
            const pagos = usuarios.filter(u => 
                u.assinaturas && 
                u.assinaturas.length > 0 && 
                u.assinaturas[0].status === 'active' && 
                u.assinaturas[0].plano !== 'trial'
            );
            if (totalPagosCount) totalPagosCount.textContent = pagos.length;
            
            // Usu√°rios dos √∫ltimos 7 dias
            const seteDiasAtras = new Date();
            seteDiasAtras.setDate(seteDiasAtras.getDate() - 7);
            const novos = usuarios.filter(u => {
                const created = new Date(u.created_at);
                return created >= seteDiasAtras;
            });
            if (novosUsuarios) novosUsuarios.textContent = novos.length;
        }
        
        function updateTodosUsuariosTable(usuarios) {
            const table = document.getElementById('todosUsuariosTableBody');
            const emptyState = document.getElementById('emptyTodosUsuarios');
            
            if (!usuarios || usuarios.length === 0) {
                table.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            table.innerHTML = usuarios.map(user => {
                const assinatura = user.assinaturas?.[0];
                
                // Badge do plano
                let planoBadge = '';
                let planoColor = 'secondary';
                
                if (user.plano === 'trial') {
                    planoBadge = 'üß™ Trial (7 dias)';
                    planoColor = 'warning';
                } else if (user.plano === 'starter') {
                    planoBadge = 'üå± Starter';
                    planoColor = 'info';
                } else if (user.plano === 'pro') {
                    planoBadge = '‚ö° Pro';
                    planoColor = 'success';
                } else {
                    planoBadge = user.plano || 'N√£o definido';
                }
                
                // Status da assinatura
                let statusBadge = '-';
                let statusColor = 'secondary';
                
                if (assinatura) {
                    if (assinatura.status === 'active') {
                        statusBadge = '‚úÖ Ativa';
                        statusColor = 'success';
                    } else if (assinatura.status === 'cancelled') {
                        statusBadge = '‚ùå Cancelada';
                        statusColor = 'danger';
                    } else if (assinatura.status === 'pending') {
                        statusBadge = '‚è≥ Pendente';
                        statusColor = 'warning';
                    } else {
                        statusBadge = assinatura.status;
                    }
                }
                
                return `
                    <tr>
                        <td>
                            <div><strong>${user.nome || '(Sem nome)'}</strong></div>
                        </td>
                        <td>
                            <div style="font-size: 13px;">${user.email}</div>
                        </td>
                        <td>${user.telefone || '-'}</td>
                        <td><span class="badge ${planoColor}">${planoBadge}</span></td>
                        <td><span class="badge ${statusColor}">${statusBadge}</span></td>
                        <td>${formatDate(user.created_at)}</td>
                        <td>
                            <button class="btn-icon" onclick="viewUsuarioCompleto('${user.id}')" title="Ver detalhes completos">
                                <i data-lucide="eye"></i>
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            lucide.createIcons();
        }
        
        function viewUsuarioCompleto(userId) {
            alert(`Ver detalhes completos do usu√°rio: ${userId}\n\nEm breve: modal com TODOS os dados!`);
        }
        
        function exportTodosUsuarios() {
            alert('üîÑ Exportar CSV de todos usu√°rios em desenvolvimento...');
        }
        
        function viewUserDetails(userId) {
            alert(`Detalhes do usu√°rio: ${userId}\n\nEm breve: modal com todos os dados do usu√°rio!`);
        }
        
        function showLoading(show) {
            const btn = document.querySelector('.btn-primary[onclick="loadData()"]');
            if (btn) {
                btn.disabled = show;
                btn.innerHTML = show 
                    ? '<i data-lucide="loader"></i> Carregando...' 
                    : '<i data-lucide="refresh-cw"></i> Atualizar';
                lucide.createIcons();
            }
        }

        // ========== TOUR DE BOAS-VINDAS ==========
        const urlParams = new URLSearchParams(window.location.search);
        const isWelcome = urlParams.get('welcome') === 'true';
        const authData = JSON.parse(localStorage.getItem('lucrocerto_auth') || '{}');
        
        // Atualizar nome do usu√°rio no header
        if (authData.nome) {
            const userNameEl = document.querySelector('.user-name');
            if (userNameEl) userNameEl.textContent = authData.nome.split(' ')[0];
        }
        
        // Mostrar tour se for primeiro acesso
        if (isWelcome || authData.isFirstLogin) {
            showWelcomeTour();
            // Remover flag de primeiro login
            authData.isFirstLogin = false;
            localStorage.setItem('lucrocerto_auth', JSON.stringify(authData));
            // Limpar URL
            window.history.replaceState({}, '', '/admin.html');
        }
        
        function showWelcomeTour() {
            const tourOverlay = document.createElement('div');
            tourOverlay.id = 'welcome-tour';
            tourOverlay.innerHTML = `
                <div class="tour-backdrop"></div>
                <div class="tour-modal">
                    <div class="tour-step" data-step="1">
                        <div class="tour-icon">üéâ</div>
                        <h2>Bem-vinda ao Lucro Certo!</h2>
                        <p>Ol√° <strong>${authData.nome?.split(' ')[0] || 'empreendedora'}</strong>! Seu pagamento foi confirmado e sua conta est√° ativa.</p>
                        <p class="tour-plan">Seu plano: <strong>${getPlanName(authData.plano)}</strong></p>
                        <button class="tour-btn" onclick="nextTourStep(2)">Come√ßar tour r√°pido ‚Üí</button>
                        <button class="tour-skip" onclick="closeTour()">Pular e come√ßar a usar</button>
                    </div>
                    
                    <div class="tour-step" data-step="2" style="display: none;">
                        <div class="tour-icon">üìä</div>
                        <h2>Dashboard</h2>
                        <p>Aqui voc√™ v√™ um resumo do seu neg√≥cio: vendas, produtos mais vendidos e m√©tricas importantes.</p>
                        <div class="tour-nav">
                            <button class="tour-btn-secondary" onclick="nextTourStep(1)">‚Üê Voltar</button>
                            <button class="tour-btn" onclick="nextTourStep(3)">Pr√≥ximo ‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="tour-step" data-step="3" style="display: none;">
                        <div class="tour-icon">üì¶</div>
                        <h2>Produtos</h2>
                        <p>Cadastre seus produtos com custo e pre√ßo de venda. O sistema calcula automaticamente sua margem de lucro!</p>
                        <div class="tour-nav">
                            <button class="tour-btn-secondary" onclick="nextTourStep(2)">‚Üê Voltar</button>
                            <button class="tour-btn" onclick="nextTourStep(4)">Pr√≥ximo ‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="tour-step" data-step="4" style="display: none;">
                        <div class="tour-icon">üí∞</div>
                        <h2>Vendas</h2>
                        <p>Registre suas vendas de forma r√°pida e veja seus lucros crescerem. Tudo organizado em um s√≥ lugar!</p>
                        <div class="tour-nav">
                            <button class="tour-btn-secondary" onclick="nextTourStep(3)">‚Üê Voltar</button>
                            <button class="tour-btn" onclick="nextTourStep(5)">Pr√≥ximo ‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="tour-step" data-step="5" style="display: none;">
                        <div class="tour-icon">üöÄ</div>
                        <h2>Tudo pronto!</h2>
                        <p>Agora √© s√≥ come√ßar a usar. Dica: comece cadastrando seus produtos!</p>
                        <button class="tour-btn tour-btn-success" onclick="closeTour()">Come√ßar a usar! ‚ú®</button>
                    </div>
                </div>
            `;
            
            // Adicionar estilos do tour
            const tourStyles = document.createElement('style');
            tourStyles.textContent = `
                #welcome-tour {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    z-index: 99999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .tour-backdrop {
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                }
                .tour-modal {
                    position: relative;
                    background: white;
                    border-radius: 24px;
                    padding: 40px;
                    max-width: 450px;
                    width: 90%;
                    text-align: center;
                    animation: tourSlideUp 0.4s ease;
                }
                @keyframes tourSlideUp {
                    from { opacity: 0; transform: translateY(30px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .tour-icon {
                    font-size: 60px;
                    margin-bottom: 20px;
                }
                .tour-modal h2 {
                    color: #37474F;
                    margin-bottom: 12px;
                    font-size: 24px;
                }
                .tour-modal p {
                    color: #607D8B;
                    margin-bottom: 12px;
                    line-height: 1.6;
                }
                .tour-plan {
                    background: linear-gradient(135deg, #E91E63, #F06292);
                    color: white !important;
                    padding: 10px 20px;
                    border-radius: 10px;
                    display: inline-block;
                    margin: 10px 0 20px !important;
                }
                .tour-btn {
                    background: linear-gradient(135deg, #E91E63, #F06292);
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 12px;
                    font-size: 15px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: transform 0.2s, box-shadow 0.2s;
                }
                .tour-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
                }
                .tour-btn-secondary {
                    background: #f5f5f5;
                    color: #37474F;
                    border: none;
                    padding: 14px 24px;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                }
                .tour-btn-success {
                    background: linear-gradient(135deg, #4CAF50, #8BC34A);
                }
                .tour-skip {
                    display: block;
                    margin-top: 16px;
                    background: none;
                    border: none;
                    color: #9E9E9E;
                    font-size: 13px;
                    cursor: pointer;
                }
                .tour-skip:hover {
                    color: #607D8B;
                }
                .tour-nav {
                    display: flex;
                    gap: 12px;
                    justify-content: center;
                    margin-top: 20px;
                }
            `;
            document.head.appendChild(tourStyles);
            document.body.appendChild(tourOverlay);
        }
        
        function nextTourStep(step) {
            document.querySelectorAll('.tour-step').forEach(s => s.style.display = 'none');
            document.querySelector(`.tour-step[data-step="${step}"]`).style.display = 'block';
        }
        
        function closeTour() {
            const tour = document.getElementById('welcome-tour');
            if (tour) {
                tour.style.opacity = '0';
                tour.style.transition = 'opacity 0.3s';
                setTimeout(() => tour.remove(), 300);
            }
        }
        
        function getPlanName(plan) {
            const names = {
                starter: 'üöÄ Starter',
                pro: '‚≠ê Profissional',
                premium: 'üëë Premium',
                trial: 'üéÅ Trial'
            };
            return names[plan] || plan;
        }

        // ========== NAVEGA√á√ÉO ==========
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const page = btn.dataset.page;
                
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active'));
                document.getElementById(`page-${page}`).classList.add('active');
                
                document.getElementById('sidebar').classList.remove('open');
                
                // üéØ Carregar dados espec√≠ficos da p√°gina
                if (page === 'trials' && isAdminAuthenticated) {
                    loadTrials(); // Carregar usu√°rios trial
                } else if (page === 'todos-usuarios' && isAdminAuthenticated) {
                    loadTodosUsuarios(); // Carregar TODOS os usu√°rios
                } else {
                    loadData();
                }
            });
        });

        document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.getElementById('sidebar').classList.toggle('open');
        });

        // ========== DADOS ==========
        function loadData() {
            // Se autenticado como admin, buscar do Supabase
            if (isAdminAuthenticated) {
                loadDashboardFromAPI();
            } else {
                // Fallback: localStorage (antigo)
                loadLeads();
                loadCupons();
                loadNichos();
                updateStats();
            }
        }

        function loadLeads() {
            const leads = JSON.parse(localStorage.getItem('lucrocerto_leads') || '[]');
            
            // Dashboard table
            const dashboardTable = document.getElementById('dashboardLeadsTable');
            const recentLeads = [...leads].sort((a, b) => new Date(b.dataCaptura) - new Date(a.dataCaptura)).slice(0, 5);
            
            dashboardTable.innerHTML = recentLeads.map(lead => `
                <tr>
                    <td><strong>${lead.nome}</strong></td>
                    <td>${lead.email}</td>
                    <td>${formatDate(lead.dataCaptura)}</td>
                    <td><span class="badge ${lead.contacted ? 'contacted' : 'new'}">${lead.contacted ? 'Contatado' : 'Novo'}</span></td>
                </tr>
            `).join('') || '<tr><td colspan="4" style="text-align: center; color: var(--elegant-gray);">Nenhum lead ainda</td></tr>';

            // Full leads table
            const leadsTable = document.getElementById('leadsTableBody');
            const emptyState = document.getElementById('emptyLeads');
            
            if (leads.length === 0) {
                leadsTable.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            leads.sort((a, b) => new Date(b.dataCaptura) - new Date(a.dataCaptura));
            
            leadsTable.innerHTML = leads.map((lead, index) => {
                let status = 'new';
                let statusText = 'Novo';
                if (lead.contacted) { status = 'contacted'; statusText = 'Contatado'; }
                if (lead.converted) { status = 'converted'; statusText = 'Convertido'; }
                
                return `
                    <tr data-status="${status}">
                        <td>
                            <div><strong>${lead.nome}</strong></div>
                            <div style="font-size: 12px; color: var(--elegant-gray);">${lead.email}</div>
                        </td>
                        <td>${lead.telefone || '-'}</td>
                        <td>${lead.cupom || '-'}</td>
                        <td>${formatDate(lead.dataCaptura)}</td>
                        <td><span class="badge ${status}">${statusText}</span></td>
                        <td>
                            <div class="actions-cell">
                                <button class="action-btn" title="WhatsApp" onclick="openWhatsApp('${lead.telefone}', '${lead.nome}')">
                                    <i data-lucide="message-circle"></i>
                                </button>
                                <button class="action-btn" title="Email" onclick="sendEmail('${lead.email}')">
                                    <i data-lucide="mail"></i>
                                </button>
                                <button class="action-btn" title="Marcar contatado" onclick="markContacted(${index})">
                                    <i data-lucide="check"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            lucide.createIcons();
        }

        function loadCupons() {
            const cupons = JSON.parse(localStorage.getItem('lucrocerto_cupons') || '[]');
            
            if (cupons.length === 0) {
                cupons.push({ codigo: 'LUCRO10', desconto: 10, usos: 0, limite: 999, validade: '2025-12-31', ativo: true });
                localStorage.setItem('lucrocerto_cupons', JSON.stringify(cupons));
            }
            
            const table = document.getElementById('cuponsTableBody');
            table.innerHTML = cupons.map((cupom, index) => `
                <tr>
                    <td><strong>${cupom.codigo}</strong></td>
                    <td>${cupom.desconto}%</td>
                    <td>${cupom.usos}/${cupom.limite}</td>
                    <td>${formatDate(cupom.validade)}</td>
                    <td><span class="badge ${cupom.ativo ? 'active' : 'cancelled'}">${cupom.ativo ? 'Ativo' : 'Inativo'}</span></td>
                    <td>
                        <div class="actions-cell">
                            <button class="action-btn" title="Copiar" onclick="copiarCupom('${cupom.codigo}')">
                                <i data-lucide="copy"></i>
                            </button>
                            <button class="action-btn" title="${cupom.ativo ? 'Desativar' : 'Ativar'}" onclick="toggleCupom(${index})">
                                <i data-lucide="${cupom.ativo ? 'pause' : 'play'}"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');
            
            lucide.createIcons();
        }

        function loadNichos() {
            const nichos = [
                { nome: 'Moda & Acess√≥rios', icon: 'üëó', count: 45, percent: 35 },
                { nome: 'Cosm√©ticos', icon: 'üíÑ', count: 32, percent: 25 },
                { nome: 'Casa & Decora√ß√£o', icon: 'üè†', count: 28, percent: 22 },
                { nome: 'Alimenta√ß√£o', icon: 'üç∞', count: 15, percent: 12 },
                { nome: 'Outros', icon: 'üì¶', count: 8, percent: 6 }
            ];

            document.getElementById('dashboardNiches').innerHTML = nichos.slice(0, 4).map(n => `
                <li class="niche-item">
                    <div class="niche-icon">${n.icon}</div>
                    <div class="niche-info">
                        <div class="niche-name">${n.nome}</div>
                        <div class="niche-bar"><div class="niche-bar-fill" style="width: ${n.percent}%"></div></div>
                    </div>
                    <div class="niche-count">${n.count}</div>
                </li>
            `).join('');

            document.getElementById('nichosDetalhados').innerHTML = nichos.map(n => `
                <li class="niche-item">
                    <div class="niche-icon">${n.icon}</div>
                    <div class="niche-info">
                        <div class="niche-name">${n.nome}</div>
                        <div class="niche-bar"><div class="niche-bar-fill" style="width: ${n.percent}%"></div></div>
                    </div>
                    <div class="niche-count">${n.count} (${n.percent}%)</div>
                </li>
            `).join('');

            document.getElementById('nichoModa').textContent = nichos[0].count;
            document.getElementById('nichoCosmeticos').textContent = nichos[1].count;
            document.getElementById('nichoCasa').textContent = nichos[2].count;
            document.getElementById('nichoAlimentacao').textContent = nichos[3].count;
        }

        function updateStats() {
            const leads = JSON.parse(localStorage.getItem('lucrocerto_leads') || '[]');
            document.getElementById('totalLeads').textContent = leads.length;
            document.getElementById('totalAssinantes').textContent = '0';
            document.getElementById('totalCupons').textContent = leads.filter(l => l.cupom).length;
            document.getElementById('totalReceita').textContent = 'R$ 0';
        }

        // ========== A√á√ïES ==========
        function openWhatsApp(phone, nome) {
            if (!phone) return alert('Telefone n√£o informado');
            const cleanPhone = phone.replace(/\D/g, '');
            const phoneWithCountry = cleanPhone.length === 11 ? '55' + cleanPhone : cleanPhone;
            const msg = encodeURIComponent(`Ol√° ${nome}! Vi que voc√™ se interessou pelo Lucro Certo üòä Posso te ajudar?`);
            window.open(`https://wa.me/${phoneWithCountry}?text=${msg}`, '_blank');
        }

        function sendEmail(email) {
            if (!email) return alert('Email n√£o informado');
            window.location.href = `mailto:${email}?subject=Seu cupom LUCRO10 est√° esperando!`;
        }

        function markContacted(index) {
            const leads = JSON.parse(localStorage.getItem('lucrocerto_leads') || '[]');
            if (leads[index]) {
                leads[index].contacted = true;
                localStorage.setItem('lucrocerto_leads', JSON.stringify(leads));
                loadLeads();
            }
        }

        function exportLeadsCSV() {
            const leads = JSON.parse(localStorage.getItem('lucrocerto_leads') || '[]');
            if (leads.length === 0) return alert('Nenhum lead para exportar');
            
            const csvContent = [
                ['Nome', 'Email', 'Telefone', 'Cupom', 'Data', 'Status'].join(','),
                ...leads.map(lead => [
                    `"${lead.nome}"`, lead.email, lead.telefone || '', lead.cupom || '',
                    lead.dataCaptura, lead.contacted ? 'Contatado' : 'Novo'
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `leads_lucrocerto_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Cupons
        function openCouponModal() { document.getElementById('couponModal').classList.add('active'); }
        function closeCouponModal() { document.getElementById('couponModal').classList.remove('active'); }

        function salvarCupom() {
            const codigo = document.getElementById('cupomCodigo').value.toUpperCase();
            const desconto = parseInt(document.getElementById('cupomDesconto').value);
            const limite = parseInt(document.getElementById('cupomLimite').value) || 999;
            const validade = document.getElementById('cupomValidade').value;

            if (!codigo || !desconto) return alert('Preencha o c√≥digo e o desconto');

            const cupons = JSON.parse(localStorage.getItem('lucrocerto_cupons') || '[]');
            cupons.push({ codigo, desconto, usos: 0, limite, validade: validade || '2025-12-31', ativo: true });
            localStorage.setItem('lucrocerto_cupons', JSON.stringify(cupons));
            
            closeCouponModal();
            loadCupons();
            alert('Cupom criado!');
        }

        function toggleCupom(index) {
            const cupons = JSON.parse(localStorage.getItem('lucrocerto_cupons') || '[]');
            if (cupons[index]) {
                cupons[index].ativo = !cupons[index].ativo;
                localStorage.setItem('lucrocerto_cupons', JSON.stringify(cupons));
                loadCupons();
            }
        }

        function copiarCupom(codigo) {
            navigator.clipboard.writeText(codigo);
            alert('Cupom copiado!');
        }

        // Campanhas
        function gerarListaCampanha() {
            const tipo = document.getElementById('campanhaTipo').value;
            const segmento = document.getElementById('campanhaSegmento').value;
            const leads = JSON.parse(localStorage.getItem('lucrocerto_leads') || '[]');
            let filtrados = leads;

            if (segmento === 'new') filtrados = leads.filter(l => !l.contacted);
            if (segmento === 'contacted') filtrados = leads.filter(l => l.contacted);
            if (segmento === 'cupom') filtrados = leads.filter(l => l.cupom && !l.converted);

            if (filtrados.length === 0) return alert('Nenhum lead encontrado');

            document.getElementById('listaEnvioBody').innerHTML = filtrados.map(lead => `
                <tr>
                    <td>${lead.nome}</td>
                    <td>${tipo === 'whatsapp' ? lead.telefone : lead.email}</td>
                    <td>
                        <button class="btn btn-primary" style="padding: 8px 16px; font-size: 12px;" 
                            onclick="${tipo === 'whatsapp' ? `openWhatsApp('${lead.telefone}', '${lead.nome}')` : `sendEmail('${lead.email}')`}">
                            <i data-lucide="${tipo === 'whatsapp' ? 'message-circle' : 'mail'}"></i>
                            Enviar
                        </button>
                    </td>
                </tr>
            `).join('');

            document.getElementById('listaEnvioCard').style.display = 'block';
            lucide.createIcons();
        }

        function salvarConfig() { alert('Configura√ß√µes salvas!'); }

        function limparLeads() {
            if (confirm('Limpar TODOS os leads? Esta a√ß√£o n√£o pode ser desfeita.')) {
                localStorage.removeItem('lucrocerto_leads');
                localStorage.removeItem('lucrocerto_lead_captured');
                loadData();
                alert('Leads limpos!');
            }
        }

        // Filtros
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const parent = btn.parentElement;
                parent.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                const filter = btn.dataset.filter;
                btn.closest('.card').querySelectorAll('tbody tr').forEach(row => {
                    row.style.display = filter === 'all' || row.dataset.status === filter ? '' : 'none';
                });
            });
        });

        document.getElementById('searchLeads')?.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#leadsTableBody tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(term) ? '' : 'none';
            });
        });

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            return new Date(dateStr).toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: '2-digit' });
        }

        // ========== INICIALIZA√á√ÉO ==========
        // Verificar autentica√ß√£o e carregar dados
        checkAdminAuth();
    </script>
</body>
</html>
