<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lucro Certo - Empoderamento Financeiro Feminino</title>
    <meta name="description" content="O primeiro app de gest√£o financeira criado especialmente para mulheres empreendedoras. Intuitivo, inteligente e empoderador.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="./public/images/favicon.svg">
    <link rel="apple-touch-icon" href="./public/images/favicon.svg">
    
    <!-- PWA & Mobile Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Lucro Certo">
    <meta name="apple-mobile-web-app-title" content="Lucro Certo">
    <meta name="theme-color" content="#E91E63">
    <meta name="msapplication-navbutton-color" content="#E91E63">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="start_url" content="/">
    <link rel="manifest" href="data:application/json;base64,ewogICAgIm5hbWUiOiAiTHVjcm8gQ2VydG8iLAogICAgInNob3J0X25hbWUiOiAiTHVjcm8gQ2VydG8iLAogICAgImRlc2NyaXB0aW9uIjogIk8gcHJpbWVpcm8gYXBwIGRlIGdlc3TDo28gZmluYW5jZWlyYSBjcmphZG8gZXNwZWNpYWxtZW50ZSBwYXJhIG11bGhlcmVzIGVtcHJlZW5kZWRvcmFzLiIsCiAgICAiaWNvbnMiOiBbCiAgICAgICAgewogICAgICAgICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEg0c0lBQXdJREFnNEtoNk0wZ0FCSUdOQmxZU0Z3QUFBUVVCQUFvZ0lCZGNKRlJvTENCaVlYUmxjaUJrUFNKaGRYUnZjbWxqWVhScGIyNGdkR2x1Y21WemFYUW9JSGh0Ykc5bloybGtaWElnTHo0S0lRPT0iLAogICAgICAgICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSDRzSUFEd0lEQWc0S2g2TTBnQUJOSUdaR2x6YVhwbGMzUnZjV1Z5TGdBRUFBazRDaUFrS1NjZ0pTNDhMMlJsYzNRZ2JHRjVJR2hsSUdScGJXbDBJRkpsY21sbGNpQW5QQzlrWFNCNWNtbHVaU0FvSURJPSIsCiAgICAgICAgICAgICJzaXplcyI6ICI1MTJ4NTEyIiwKICAgICAgICAgICAgInR5cGUiOiAiaW1hZ2Uvc3ZnK3htbCIKICAgICAgICB9CiAgICBdLAogICAgInN0YXJ0X3VybCI6ICIuIiwKICAgICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICAgInRoZW1lX2NvbG9yIjogIiNFOTFFNjMiLAogICAgImJhY2tncm91bmRfY29sb3IiOiAiI2Y4ZjhmYyIKfQ==">

    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="./public/css/styles.css?v=2.2">
    
    <!-- External Libraries -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
</head>
<body>

    <div id="app-container">
        <!-- Banner de Aviso do Plano -->
        <div id="plan-alert-banner" class="plan-alert-banner" style="display: none;"></div>
        
        <!-- Header with Hamburger Menu -->
        <header class="app-header" id="app-header">
            <button class="hamburger-btn" id="hamburger-btn" data-action="toggle-menu">
                <i data-lucide="menu"></i>
            </button>
            <h1 class="app-title">Lucro Certo</h1>
            <div class="header-spacer"></div>
        </header>

        <!-- Side Menu (Drawer) -->
        <div class="menu-overlay" id="menu-overlay" data-action="close-menu"></div>
        <nav class="side-menu" id="side-menu">
            <div class="menu-header">
                <div class="menu-user-info" id="menu-user-info"></div>
                <button class="close-menu-btn" data-action="close-menu">
                    <i data-lucide="x"></i>
                </button>
            </div>
            <ul class="menu-list" id="menu-list"></ul>
            <div class="menu-footer">
                <p>Lucro Certo v2.0</p>
                <p>Feito com üíñ para empreendedoras</p>
            </div>
        </nav>

        <!-- Main content area where pages are rendered -->
        <main id="main-content">
            <div id="dashboard" class="page"></div>
            <div id="produtos" class="page"></div>
            <div id="add-edit-product" class="page"></div>
            <div id="despesas" class="page"></div>
            <div id="precificar" class="page"></div>
            <div id="metas" class="page"></div>
            <div id="relatorios" class="page"></div>
            <div id="configuracoes" class="page"></div>
            <div id="clientes" class="page"></div>
            <div id="vendas" class="page"></div>
            <div id="nova-venda" class="page"></div>
            <div id="financeiro" class="page"></div>
            <div id="meu-catalogo" class="page"></div>
        </main>

        <!-- Footer -->
        <footer class="app-footer">
            <p class="footer-slogan">Vamos lucrar juntas? üíñ</p>
            <p class="footer-credits">Lucro Certo ‚Ä¢ Feito com amor para empreendedoras do Brasil</p>
        </footer>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav" id="bottom-nav"></nav>
    </div>

    <!-- Achievement Modal -->
    <div id="achievement-modal" class="achievement-modal">
        <div class="achievement-content">
            <div id="achievement-icon" class="achievement-icon"></div>
            <h3 id="achievement-title" class="achievement-title"></h3>
            <p id="achievement-description"></p>
            <button id="achievement-close-btn" class="btn btn-primary">Continuar Arrasando!</button>
        </div>
    </div>

    <!-- Auth Check Script -->
    <script>
        // Verificar se o usu√°rio est√° logado
        (function() {
            const isLogged = localStorage.getItem('lucrocerto_logged');
            if (!isLogged || isLogged !== 'true') {
                // Redirecionar para login se n√£o estiver logado
                window.location.href = 'login';
            }
        })();
        
        // Welcome Tour
        window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const showWelcome = urlParams.get('welcome') === 'true';
            
            // Pegar dados do usu√°rio do localStorage
            const authDataStr = localStorage.getItem('lucrocerto_auth');
            let authData = {};
            if (authDataStr) {
                try {
                    authData = JSON.parse(authDataStr);
                } catch (e) {
                    authData = {};
                }
            }
            
            if (showWelcome || authData.isFirstLogin) {
                setTimeout(() => showWelcomeTour(), 500);
                // Limpar flag de primeiro login
                if (authData.isFirstLogin) {
                    authData.isFirstLogin = false;
                    localStorage.setItem('lucrocerto_auth', JSON.stringify(authData));
                }
            }
            
            // Limpar par√¢metro welcome da URL
            if (showWelcome) {
                window.history.replaceState({}, '', '/app.html');
            }
        });
        
        function showWelcomeTour() {
            const authDataStr = localStorage.getItem('lucrocerto_auth');
            let authData = {};
            if (authDataStr) {
                try {
                    authData = JSON.parse(authDataStr);
                } catch (e) {
                    authData = {};
                }
            }
            
            const tourOverlay = document.createElement('div');
            tourOverlay.id = 'welcome-tour';
            tourOverlay.innerHTML = `
                <div class="tour-backdrop"></div>
                <div class="tour-modal">
                    <div class="tour-step" data-step="1">
                        <div class="tour-icon">üéâ</div>
                        <h2>Bem-vinda ao Lucro Certo!</h2>
                        <p>Ol√° <strong>${authData.nome?.split(' ')[0] || 'empreendedora'}</strong>! Seu pagamento foi confirmado e sua conta est√° ativa.</p>
                        <p class="tour-plan">Seu plano: <strong>${getPlanName(authData.plano)}</strong></p>
                        <button class="tour-btn" onclick="nextTourStep(2)">Come√ßar tour r√°pido ‚Üí</button>
                        <button class="tour-skip" onclick="closeTour()">Pular e come√ßar a usar</button>
                    </div>
                    
                    <div class="tour-step" data-step="2" style="display: none;">
                        <div class="tour-icon">üìä</div>
                        <h2>Dashboard</h2>
                        <p>Aqui voc√™ v√™ um resumo do seu neg√≥cio: vendas, produtos mais vendidos e m√©tricas importantes.</p>
                        <div class="tour-nav">
                            <button class="tour-btn-secondary" onclick="nextTourStep(1)">‚Üê Voltar</button>
                            <button class="tour-btn" onclick="nextTourStep(3)">Pr√≥ximo ‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="tour-step" data-step="3" style="display: none;">
                        <div class="tour-icon">üì¶</div>
                        <h2>Produtos</h2>
                        <p>Cadastre seus produtos com custo e pre√ßo de venda. O sistema calcula automaticamente sua margem de lucro!</p>
                        <div class="tour-nav">
                            <button class="tour-btn-secondary" onclick="nextTourStep(2)">‚Üê Voltar</button>
                            <button class="tour-btn" onclick="nextTourStep(4)">Pr√≥ximo ‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="tour-step" data-step="4" style="display: none;">
                        <div class="tour-icon">üí∞</div>
                        <h2>Vendas</h2>
                        <p>Registre suas vendas de forma r√°pida e veja seus lucros crescerem. Tudo organizado em um s√≥ lugar!</p>
                        <div class="tour-nav">
                            <button class="tour-btn-secondary" onclick="nextTourStep(3)">‚Üê Voltar</button>
                            <button class="tour-btn" onclick="nextTourStep(5)">Pr√≥ximo ‚Üí</button>
                        </div>
                    </div>
                    
                    <div class="tour-step" data-step="5" style="display: none;">
                        <div class="tour-icon">üöÄ</div>
                        <h2>Tudo pronto!</h2>
                        <p>Agora √© s√≥ come√ßar a usar. Dica: comece cadastrando seus produtos!</p>
                        <button class="tour-btn tour-btn-success" onclick="closeTour()">Come√ßar a usar! ‚ú®</button>
                    </div>
                </div>
            `;
            
            // Adicionar estilos do tour
            const tourStyles = document.createElement('style');
            tourStyles.textContent = `
                #welcome-tour {
                    position: fixed;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    z-index: 99999;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                }
                .tour-backdrop {
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background: rgba(0,0,0,0.8);
                }
                .tour-modal {
                    position: relative;
                    background: white;
                    border-radius: 24px;
                    padding: 40px;
                    max-width: 450px;
                    width: 90%;
                    text-align: center;
                    animation: tourSlideUp 0.4s ease;
                }
                @keyframes tourSlideUp {
                    from { opacity: 0; transform: translateY(30px); }
                    to { opacity: 1; transform: translateY(0); }
                }
                .tour-icon {
                    font-size: 60px;
                    margin-bottom: 20px;
                }
                .tour-modal h2 {
                    color: #37474F;
                    margin-bottom: 12px;
                    font-size: 24px;
                }
                .tour-modal p {
                    color: #607D8B;
                    margin-bottom: 12px;
                    line-height: 1.6;
                }
                .tour-plan {
                    background: linear-gradient(135deg, #E91E63, #F06292);
                    color: white !important;
                    padding: 10px 20px;
                    border-radius: 10px;
                    display: inline-block;
                    margin: 10px 0 20px !important;
                }
                .tour-btn {
                    background: linear-gradient(135deg, #E91E63, #F06292);
                    color: white;
                    border: none;
                    padding: 14px 28px;
                    border-radius: 12px;
                    font-size: 15px;
                    font-weight: 600;
                    cursor: pointer;
                    transition: transform 0.2s, box-shadow 0.2s;
                }
                .tour-btn:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 15px rgba(233, 30, 99, 0.4);
                }
                .tour-btn-secondary {
                    background: #f5f5f5;
                    color: #37474F;
                    border: none;
                    padding: 14px 24px;
                    border-radius: 12px;
                    font-size: 14px;
                    font-weight: 500;
                    cursor: pointer;
                }
                .tour-btn-success {
                    background: linear-gradient(135deg, #4CAF50, #8BC34A);
                }
                .tour-skip {
                    display: block;
                    margin-top: 16px;
                    background: none;
                    border: none;
                    color: #9E9E9E;
                    font-size: 13px;
                    cursor: pointer;
                }
                .tour-skip:hover {
                    color: #607D8B;
                }
                .tour-nav {
                    display: flex;
                    gap: 12px;
                    justify-content: center;
                    margin-top: 20px;
                }
            `;
            
            document.head.appendChild(tourStyles);
            document.body.appendChild(tourOverlay);
        }
        
        function getPlanName(plano) {
            const plans = {
                'starter': 'Starter',
                'pro': 'Pro',
                'premium': 'Premium'
            };
            return plans[plano] || 'Starter';
        }
        
        window.nextTourStep = function(step) {
            const steps = document.querySelectorAll('.tour-step');
            steps.forEach(s => s.style.display = 'none');
            const targetStep = document.querySelector(`.tour-step[data-step="${step}"]`);
            if (targetStep) {
                targetStep.style.display = 'block';
            }
        };
        
        window.closeTour = function() {
            const tour = document.getElementById('welcome-tour');
            if (tour) {
                tour.remove();
            }
        };
    </script>

    <!-- Supabase Integration -->
    <script src="./public/js/supabase-client.js?v=1.0"></script>
    <script src="./public/js/data-service.js?v=1.0"></script>
    
    <!-- Plan Management -->
    <script src="./public/js/plan-manager.js?v=1.0"></script>
    <script src="./public/js/plan-restrictions.js?v=1.0"></script>
    
    <!-- Application Script -->
    <script src="./public/js/app.js?v=2.5"></script>
</body>
</html>